{% if annotations %}
<nav class="nav-highlight" aria-label="Highlights and notes">
    <ul id="annotationsContainer" class="list list-divided list-highlight">
        {% for a in annotations %}
        <div id="annotation{{a.id}}" data-annotation-id="{{a.id}}" data-annotation="{{a.highlight_base64}}" class="list-item annotation-container">
            <a href="#"
               data-cle-handler="click" data-cle-control="reader-navigation-annotation" data-cle-value="annotation-nav-link:{{a.id}}"
               class="goto-highlight highlight">{{ a.clean_text_limited }}</a>
            <ul class="list list-divided list-horizontal list-highlight-action">
                {% if not a.note %}
                <li class="list-item note-add-button"><a href="#" role="button" class="note-edit-button">Add a note</a></li>
                {% endif %}
                <li class="list-item"><a href="#" role="button" class="delete-highlight">Delete highlight</a></li>
            </ul>
            <div class="note note-edit" style="display:none;">
                <div class="note-title">
                    <span class="icon-sticky-note-o" aria-hidden="true"></span>Note
                </div>
                <form>
                    <div class="form-group">
                        <input type="text" value="{{ a.note|default_if_none:'' }}"
                               class="form-control form-control-small" placeholder="Add a note..." aria-label="Add a note">
                    </div>
                    <div>
                        <button type="submit" class="btn btn-primary btn-small">Done</button>
                    </div>
                </form>
            </div>
            <div class="note note-display" {% if not a.note %}style="display:none;"{% endif %}>
                <div class="note-title">
                    <span class="icon-sticky-note-o" aria-hidden="true"></span>Note
                </div>
                <p>{{ a.note|default_if_none:'' }}</p>
                <ul class="list list-divided list-horizontal list-note-action">
                    <li class="list-item"><a href="#" role="button" class="note-edit-button">Edit</a></li>
                    <li class="list-item"><a href="#" role="button">Delete note</a></li>
                </ul>
            </div>
        </div>
        {% endfor %}
    </ul>
</nav>
{% else %}
<p id="noAnnotationsMessage">No highlights or notes yet.</p>
{% endif %}
<script>
// $('body').on('click', '.add-note-button', function(e) {
//     e.preventDefault();
//     console.debug('note ADD');
//     $container = $(this).closest('.annotation-container');
//     $container.find('.note-display').hide();
//     $container.find('.note-edit').show();
// });

$('body').on('click', '.note-edit-button', function(e) {
   e.preventDefault();
   console.debug('note EDIT');
   $container = $(this).closest('.annotation-container');
   $container.find('.note-display').hide();
   $container.find('.note-edit').show();
   $container.find('.note-add-button').hide(); // Really only needed if that was the button clicked.
});

$('body').on('click', '.note button[type=submit]', function(e) {
    e.preventDefault();
    console.debug('note DONE');
    $container = $(this).closest('.annotation-container');
    $container.find('.note-display').show();
    $container.find('.note-edit').hide();
});

$('.note-edit').hide();
</script>
