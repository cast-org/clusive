{% extends "shared/base.html" %}
{% load static figuration %}

{% block bodyClass %}library{% endblock %}

{% block title %}Add from Bookshare{% endblock %}

{% block header %}
{% include "shared/partial/site_header.html" %}
{% endblock %}

{% block content %}
<main id="content" tabindex="-1">
    <h1>Bookshare: Import</h1>
    <div class="row">
        <div class="col-md-9 col-lg-6">
            <div class="box">
                <h2>Step 3: Review and edit</h2>
                <form method="post">
                    <div class="form-group">
                        {% csrf_token %}
                        <p>Bookshare download:</p>
                        <ul>
                            <li>Title: {{ title.title }}</li>
                            {% for author in title.clusive.authors %}
                            <li>Author: {{ author }}</li>
                            {% empty %}
                            <li>No author</li>
                            {% endfor %}
                            <li>ISBN: {{ title.isbn13 }}</li>
                            <li><img src="{{ title.clusive.thumbnail }}" alt="Cover of {{ title.title }}"</img></li>
                            {% if title.clusive.more %}
                            <li id="short_{{ title.bookshareId }}">
                                Description: {{ title.clusive.synopsis }} &hellip;
                                <button id="more_{{title.bookshareId}}" class="link-btn more-or-less" aria-label="See more about {{ title.title }}">See more</button>
                            </li>
                            <li id="long_{{ title.bookshareId }}" style="display: none">
                                Description: {{ title.synopsis }}
                                <button id="less_{{title.bookshareId}}" class="link-btn more-or-less" aria-label="See less about {{ title.title }}">See less</button>
                            </li>
                            {% else %}
                            <li id="long_{{ title.bookshareId }}">
                               Description: {{ title.synopsis }}
                            </li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <div class="form-group">
                        <input type="submit" class="btn btn-secondary btn-small" value="Import" disabled/>
                        <a href="/library/bookshare-results/{{ previous }}" class="btn btn-link btn-small">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- TODO: Move this moreOrLess() script to a common location, such as frontend/js/... -->
    <script type="text/javascript">
        clusive.moreOrLess = function (event) {
            const id = (event.target.id).replace(/(more_|less_)/, '');
            const action = (event.target.id).replace(id, '');
            if (action === "more_") {
                var elementToShow = document.getElementById(`long_${id}`);
                var elementToHide = document.getElementById(`short_${id}`);
            }
            else if (action === "less_") {
                var elementToHide = document.getElementById(`long_${id}`);
                var elementToShow = document.getElementById(`short_${id}`);
            }
            elementToHide.style.display = 'none';
            elementToShow.style.display = 'block';
            event.preventDefault();
        }

        $(document).ready(function() {
            moreOrLessButtons = document.querySelectorAll('.more-or-less');
            moreOrLessButtons.forEach(function (aButton) {
                aButton.addEventListener ("click", clusive.moreOrLess);
            });
        });
    </script>
</main>
{% endblock %}

