# Generated by Django 2.2.13 on 2020-07-24 14:52

from django.db import migrations


# The path in the 'cover' field used to be assumed to be in the 0-version of the Book.
# Now that they can be uploaded, we should not make that assumption, so the path should
# be from the book's base storage dir.  Add "0/" to all existing data.
def adjust_path(apps, schema_editor):
    # We can't import the Book model directly as it may be a newer
    # version than this migration expects. We use the historical version.
    Book = apps.get_model('library', 'Book')
    for book in Book.objects.all():
        if book.cover:
            book.cover = '0/' + book.cover
            book.save()

def reverse_adjust_path(apps, schema_editor):
    Book = apps.get_model('library', 'Book')
    for book in Book.objects.all():
        if book.cover and book.cover.startswith('0/'):
            book.cover = book.cover[2:]
            book.save()

class Migration(migrations.Migration):

    dependencies = [
        ('library', '0017_auto_20200716_1359'),
    ]

    operations = [
        migrations.RunPython(adjust_path, reverse_adjust_path),
    ]
